---

title: "habtools: Complexity Metrics for 3D Meshes 教學"
author: "Guan-Yan Chen"
date: "`r Sys.Date()`"
output: github_document
---

# 簡介 / Introduction

本教學示範如何使用 `habtools` 套件計算三維網格 (3D mesh) 的複雜度指標。
This tutorial demonstrates how to compute complexity metrics for 3D meshes using the `habtools` package.

## 前置作業與資料載入 / Setup and Data Loading

**中文說明**：載入必要的套件並載入範例網格資料 `mcap`。
**English Explanation**: Load the required packages and the example mesh data `mcap`.

```{r setup, echo=TRUE}
# 載入套件 / Load packages
library(habtools)
library(rgl)
options(rgl.printRglwidget = TRUE)

# 載入範例網格資料 / Load example mesh data
# `mcap` 範例資料包含在 habtools 套件中
data("mcap", package = "habtools")
```

## 檢查網格 / Checking your mesh

在計算任何指標前，先視覺化網格並檢查 z 軸方向是否正確。
Before calculating any metrics, visualize the mesh and ensure the z orientation is correct.

```{r check-mesh, echo=TRUE}
# 顯示三維網格視覺化 / Visualize the 3D mesh
plot3d(mcap)
```

## 使用自己的資料 / Using your own data

**中文說明**：請將下列程式碼段替換為您的網格資料路徑或讀取方式。
**English Explanation**: Replace the code below with your own mesh data path or loading method.

```{r your-data, echo=TRUE}
# 載入必要套件 / Load necessary packages
library(habtools)
library(rgl)

# 載入您的網格資料 / Load your own mesh data
# 例如，如果您的資料是 OBJ 格式：
# mesh <- Rvcg::vcgImport("path/to/your_mesh.obj")
# 或者 PLY 格式：
# mesh <- Rvcg::vcgImport("path/to/your_mesh.ply")

# 確認網格 / Check mesh
plot3d(mesh)

# 計算並顯示 Rugosity / Compute and display rugosity
rug_value <- rg(mesh)
print(rug_value)

# 其他指標 / Other metrics
# fd_result <- fd(mesh, method = "cubes", plot = TRUE, diagnose = TRUE)
# print(fd_result$D)
```

## 解析度分佈 / Resolution Distribution

**中文說明**：計算網格中相鄰頂點間距並繪製直方圖以檢查解析度變異。
**English Explanation**: Compute distances between adjacent vertices in the mesh and plot a histogram to inspect variation in resolution.

```{r resolution-histogram, echo=TRUE}
# 計算解析度向量 / Calculate vector of resolutions
resvec <- Rvcg::vcgMeshres(mcap)[[2]]

# 繪製直方圖 / Plot histogram of resolutions
hist(resvec)
```

```{r resolution-summary, echo=TRUE}
# 顯示解析度摘要統計 / Display summary statistics of resolutions
summary(resvec)
```

## 均勻重網格 / Uniform Remeshing

**中文說明**：使用最小解析度作為 voxelSize 重新均勻網格，以減少點間距差異。
**English Explanation**: Uniformly remesh using the minimum resolution as `voxelSize` to reduce variation in vertex spacing.

```{r remesh, echo=TRUE}
# 均勻重網格 / Uniformly remesh mesh
mcap_uniform <- Rvcg::vcgUniformRemesh(
  mcap,
  silent = TRUE,
  multiSample = TRUE,
  voxelSize = min(resvec),
  mergeClost = TRUE
)

# 驗證重網格後解析度 / Check resolution of the remeshed object
Rvcg::vcgMeshres(mcap_uniform)[[1]]  
summary(Rvcg::vcgMeshres(mcap_uniform)[[2]])
```

## 複雜度指標：R, D, 和 H / Complexity metrics: R, D, and H

### 分形維度 / Fractal Dimension

**中文說明**：使用 `cubes` 方法計算 mesh 的分形維度。
**English Explanation**: Compute the fractal dimension of the mesh using the `cubes` method.

```{r fractal-dimension, echo=TRUE, fig.height=4}
# 分形維度計算 / Calculate fractal dimension
fd_result <- fd(
  mcap_uniform,
  method = "cubes",
  plot = TRUE,
  diagnose = TRUE
)
# 提取 D 值 / Extract fractal dimension
fd_result$D
```

### Rugosity 及高度範圍 / Rugosity and Height Range

```{r rugosity-height, echo=TRUE}
# Rugosity 計算 / Compute rugosity
rg(mcap_uniform)

# 計算高度範圍 / Compute height range
hr(mcap_uniform)
```

### 平面與表面積 / Planar and Surface Area

```{r area-metrics, echo=TRUE}
# 平面表面積 / Planar surface area
planar(mcap)

# 總表面積 / Total surface area
surface_area(mcap)
```

## 形狀指標 / Shape Metrics

**中文說明**：計算多種描述物體形狀的指標。
**English Explanation**: Compute various metrics that describe the shape of the object.

```{r shape-metrics, echo=TRUE}
convexity(mcap)    # 凸度 / Convexity
packing(mcap)      # 打包度 / Packing
sphericity(mcap)   # 球形度 / Sphericity
sma(mcap)          # 面積二階矩 / Second moment of area
smv(mcap)          # 體積二階矩 / Second moment of volume
csf(mcap)          # 機械形狀因子 / Mechanical shape factor
```

## 轉換為 DEM 或 2D 形狀 / Transform mesh into a DEM or 2D shape

```{r mesh-to-dem, echo=TRUE}
# 轉換為數字高程模型 / Convert mesh to DEM
dem <- mesh_to_dem(mcap_uniform, res = 0.002, fill = FALSE)
# 繪製 DEM / Plot DEM
raster::plot(dem)

# 在 DEM 上計算 Rugosity (area 方法) / Compute rugosity on DEM
rg(dem, method = "area")
```

```{r mesh-to-2d, echo=TRUE}
# 轉換為 2D 點集 / Convert mesh to 2D points
pts <- mesh_to_2d(mcap_uniform)
plot(pts, asp = 1)

# 周長計算 / Compute perimeter
perimeter(pts)

# 圓形度計算 / Compute circularity
circularity(pts)

# 2D 分形維度 (boxes 方法) / Compute fractal dimension in 2D
fd(pts, method = "boxes", keep_data = FALSE, plot = TRUE)
```

## 參考文獻 / References

* Zawada KJA, Dornelas M, Madin JS (2019) Quantifying coral morphology. *Coral Reefs*, **38**:1281–1292.
* Madin JS & Connolly SR (2006) Ecological consequences of major hydrodynamic disturbances on coral reefs. *Nature*, **444**:477–480.
